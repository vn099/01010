<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>60 d√£y A ‚Äì Mask 5 bit</title>

<style>
body { font-family: Arial, sans-serif; padding: 10px; }
table { border-collapse: collapse; width: 100%; max-width: 1800px; }
th, td { border: 1px solid #ccc; padding: 4px; text-align: center; }

input.bit {
  width: 24px;
  height: 24px;
  font-size: 14px;
  text-align: center;
  margin: 0 1px;
  background-color: yellow;
  border: 1px solid #999;
  border-radius: 8px;
  font-weight: bold;
}

input.bit.c-bit {
  cursor: default;
}
 

/* bit mask c∆° b·∫£n */
.mask-bit {
  width: 26px;
  height: 26px;
  text-align: center;
  border: 1px solid #bbb;
  border-radius: 4px;
  font-weight: bold;
  color: #444;
  background: #f8f9fa;
  margin: 2px;
}



/* nh√¨n cho ƒë·ª° c·ª©ng */
.mask-bit[readonly] {
  cursor: default;
}

.bit-box {
  display: inline-block;
  width: 24px;
}
.mask-bit.mask-diff {
  background: #1E90FF;   /* xanh */
  color: #fff;
  border-color: #1E90FF;
}
.mask-bit.mask-same {
  background: #000;
  color: #fff;
  border-color: #000;
}


.a-match {
  background-color: red !important;
  color: #fff !important;
}

textarea.row-output {
  width: 100px;
  height: 32px;
  resize: none;
  font-family: monospace;
  font-size: 14px;
}

button {
  margin: 6px 6px 12px 0;
  padding: 8px 20px;
  font-size: 16px;
}
</style>
</head>

<body>

<h3>60 d√£y A (5 bit) - Lucky Star 9 </h3>

<button onclick="copyAll()">Copy const FINAL_MASKS</button>
<button onclick="resetAll()">Reset</button>

<table>
<thead>
<tr>
  <th>#</th>
  <th> Nh√¢Ã£p k√™ÃÅt quaÃâ </th>
  <th>Mask ban ƒë·∫ßu</th>
  <th>L√¢ÃÅy biÃÅt ƒë√™Ãâ Start</th>
  <th>Mask ƒëaÃÉ n√¢ng c√¢ÃÅp</th>
  <th>Chu·ªói mask</th>
</tr>
</thead>
<tbody id="rows"></tbody>
</table>

<script>
const MASKS = [
  "10101","01010","11000","00111","10010","01101",
  "11100","00011","10110","01101","11010","00101",
  "10001","01110","11101","00010","10100","01011",
  "11001","00110","10011","01100","11110","00001",
  "10111","01000","11011","00100","10000","01111",
  "11111","00000","10101","01010","11000","00111",
  "10010","01101","11100","00011","10110","01001",
  "11010","00101","10001","01110","11101","00010",
  "10111","01000","11011","00100","10000","01111",
  "11111","00000","10101","01010","11000","00111"
];

const FINAL_MASKS = Array(60).fill(null);
const tbody = document.getElementById("rows");

/* ===== T·∫†O B·∫¢NG ===== */
for (let i = 0; i < 60; i++) {
  const tr = document.createElement("tr");
  tr.innerHTML = `
    <td>${i + 1}</td>
    <td>
      ${Array(5).fill(0).map(() =>
        `<input class="bit" maxlength="1"
         inputmode="numeric" pattern="[01]"
         oninput="handleInput(this)">`
      ).join("")}
    </td>
    <td>${MASKS[i].split("").map(b =>
      `<span class="bit-box">${b}</span>`
    ).join("")}</td>
    <td id="c-${i}">
      ${Array(5).fill(0).map(() =>
        `<input class="bit c-bit" readonly>`
      ).join("")}
    </td>
    <td id="out-${i}"></td>
    <td><textarea class="row-output" id="txt-${i}" readonly></textarea></td>
  `;
  tbody.appendChild(tr);
}

/* ===== INPUT ===== */
function handleInput(el) {
  el.value = el.value.replace(/[^01]/g, "");

  const row = el.closest("tr");
  const inputs = [...row.querySelectorAll("td:nth-child(2) input.bit")];
  const idx = inputs.indexOf(el);

  if (el.value && idx < 4) inputs[idx + 1].focus();

  if (inputs.every(i => i.value !== "")) {
    calculateRow(row);
    // üîÅ t√≠nh l·∫°i mask cho h√†ng tr∆∞·ªõc (n·∫øu c√≥)
const prevRow = row.previousElementSibling;
if (prevRow) {
  calculateRow(prevRow);
}

    row.nextElementSibling
      ?.querySelector("td:nth-child(2) input.bit")
      ?.focus();
  }
}

/* ===== T√çNH H√ÄNG ===== */
function calculateRow(row) {
  const idx = row.rowIndex - 1;

  /* --- A h√†ng hi·ªán t·∫°i --- */
  const A = [...row.querySelectorAll("td:nth-child(2) input.bit")]
    .map(i => +i.value);

  const baseMask = MASKS[idx].split("").map(Number);

  /* --- C‚ÇÅ = A‚ÇÅ XOR mask g·ªëc --- */
  const C = A.map((b, i) => b ^ baseMask[i]);
  row.querySelectorAll(".c-bit").forEach((el, i) => {
    el.value = C[i];
    el.style.color = C[i] ? "red" : "#0096c7";
  });
  const rowIdx = row.rowIndex - 1;
highlightAMatchWithPrevC(rowIdx);

/* --- MASK SAU S·ª¨A --- */
let newMask = baseMask.slice();
let diffA2C1 = Array(5).fill(false);

if (idx < 59) {
  const nextRow = tbody.rows[idx + 1];
  const nextInputs =
    nextRow.querySelectorAll("td:nth-child(2) input.bit");

  if ([...nextInputs].every(i => i.value !== "")) {
    const A2 = [...nextInputs].map(i => +i.value);

    for (let i = 0; i < 5; i++) {
      if (A2[i] !== C[i]) {
        newMask[i] ^= 1;      // s·ª≠a mask
        diffA2C1[i] = true;   // ƒë√°nh d·∫•u ƒë·ªÉ t√¥ xanh
      }
    }
  } else {
    row.querySelector(`#out-${idx}`).innerHTML = "";
    document.getElementById(`txt-${idx}`).value = "";
    FINAL_MASKS[idx] = null;
    return;
  }
}

/* --- HI·ªÇN TH·ªä MASK 2 --- */
FINAL_MASKS[idx] = newMask.slice();

row.querySelector(`#out-${idx}`).innerHTML =
  newMask.map((b, i) =>
   `<input class="bit mask-bit ${diffA2C1[i] ? 'mask-diff' : 'mask-same'}"
          value="${b}" readonly>`
  ).join("");

document.getElementById(`txt-${idx}`).value =
  `[${newMask.join(",")}],`;
  

}

/* ===== SO S√ÅNH A2 vs C1 TR∆Ø·ªöC TIÃÄM BIÃÅT TRUÃÄNG ƒê√äÃâ T√î MAÃÄU===== */
function highlightAMatchWithPrevC(idx) {
  if (idx <= 0 || idx >= 60) return;

  const row = tbody.rows[idx];
  const prevRow = tbody.rows[idx - 1];
  const A_inputs = row.querySelectorAll("td:nth-child(2) input.bit");
  const C_prev = [...prevRow.querySelectorAll(".c-bit")].map(i => i.value);

  A_inputs.forEach((input, i) => {
    input.classList.remove("a-match");
    if (
  input.value !== "" &&
  C_prev[i] !== "" &&
  input.value === C_prev[i]
) {

      input.classList.add("a-match");
    }
  });
}

function copyAll() {
  if (FINAL_MASKS.some(v => v === null)) {
    alert("Ch∆∞a ƒë·ªß mask h·ª£p l·ªá");
    return;
  }

  const rows = [];
  for (let i = 0; i < 60; i += 6) {
    rows.push(FINAL_MASKS.slice(i, i + 6));
  }

  const text =
`const FINAL_MASKS = [
${rows.map(group =>
  `   ${group.map(m => `[${m.join(",")}]`).join(", ")} `
).join("\n")}
];`;

  navigator.clipboard.writeText(text);
  alert("ƒê√£ copy FINAL_MASKS (10 h√†ng √ó 6 mask)");
}


function resetAll() {
  // x√≥a value
  document.querySelectorAll("input.bit").forEach(i => {
    i.value = "";
    i.classList.remove("a-match"); // üîë QUAN TR·ªåNG
  });

  // x√≥a C
  document.querySelectorAll(".c-bit").forEach(i => {
    i.value = "";
    i.style.color = "";
  });

  // x√≥a mask hi·ªÉn th·ªã
  document.querySelectorAll("td[id^='out-']").forEach(td => td.innerHTML = "");

  // x√≥a textarea
  document.querySelectorAll("textarea").forEach(t => t.value = "");

  // x√≥a data
  FINAL_MASKS.fill(null);

  // n·∫øu c√≥ localStorage
  localStorage.removeItem("FINAL_MASKS");
}

</script>

</body>
</html>







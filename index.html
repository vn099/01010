<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>60 d√£y A ‚Äì Mask 5 bit</title>

<style>
body { font-family: Arial, sans-serif; padding: 10px; }
table { border-collapse: collapse; width: 100%; max-width: 1800px; }
th, td { border: 1px solid #ccc; padding: 4px; text-align: center; }

input.bit {
  width: 30px;
  height: 36px;
  font-size: 18px;
  text-align: center;
  margin: 0 6px;
  background-color: yellow;
  border: 1px solid #999;
  border-radius: 8px;
  font-weight: bold;
}

input.bit.c-bit {
  cursor: default;
}

.bit-box {
  display: inline-block;
  width: 26px;
}

.changed {
  background: "#0096c7";
  color: #fff;
  font-weight: bold;
}

.a-match {
  background-color: #ff4d4d !important;
  color: #fff !important;
}

textarea.row-output {
  width: 150px;
  height: 32px;
  resize: none;
  font-family: monospace;
  font-size: 14px;
}

button {
  margin: 6px 6px 12px 0;
  padding: 8px 20px;
  font-size: 16px;
}
</style>
</head>

<body>

<h3>60 d√£y A (5 bit) - Lucky </h3>

<button onclick="copyAll()">Copy const FINAL_MASKS</button>
<button onclick="resetAll()">Reset</button>

<table>
<thead>
<tr>
  <th>#</th>
  <th>A (5 bit)</th>
  <th>Mask ban ƒë·∫ßu</th>
  <th>C = A XOR Mask</th>
  <th>Mask sau s·ª≠a</th>
  <th>Chu·ªói mask</th>
</tr>
</thead>
<tbody id="rows"></tbody>
</table>

<script>
const MASKS = [
  "10101","01010","11000","00111","10010","01101",
  "11100","00011","10110","01101","11010","00101",
  "10001","01110","11101","00010","10100","01011",
  "11001","00110","10011","01100","11110","00001",
  "10111","01000","11011","00100","10000","01111",
  "11111","00000","10101","01010","11000","00111",
  "10010","01101","11100","00011","10110","01001",
  "11010","00101","10001","01110","11101","00010",
  "10111","01000","11011","00100","10000","01111",
  "11111","00000","10101","01010","11000","00111"
];

const FINAL_MASKS = Array(60).fill(null);
const tbody = document.getElementById("rows");

/* ===== T·∫†O B·∫¢NG ===== */
for (let i = 0; i < 60; i++) {
  const tr = document.createElement("tr");
  tr.innerHTML = `
    <td>${i + 1}</td>
    <td>
      ${Array(5).fill(0).map(() =>
        `<input class="bit" maxlength="1"
         inputmode="numeric" pattern="[01]"
         oninput="handleInput(this)">`
      ).join("")}
    </td>
    <td>${MASKS[i].split("").map(b =>
      `<span class="bit-box">${b}</span>`
    ).join("")}</td>
    <td id="c-${i}">
      ${Array(5).fill(0).map(() =>
        `<input class="bit c-bit" readonly>`
      ).join("")}
    </td>
    <td id="out-${i}"></td>
    <td><textarea class="row-output" id="txt-${i}" readonly></textarea></td>
  `;
  tbody.appendChild(tr);
}

/* ===== INPUT ===== */
function handleInput(el) {
  el.value = el.value.replace(/[^01]/g, "");

  const row = el.closest("tr");
  const inputs = [...row.querySelectorAll("td:nth-child(2) input.bit")];
  const idx = inputs.indexOf(el);

  if (el.value && idx < 4) inputs[idx + 1].focus();

  if (inputs.every(i => i.value !== "")) {
    calculateRow(row);
    // üîÅ t√≠nh l·∫°i mask cho h√†ng tr∆∞·ªõc (n·∫øu c√≥)
const prevRow = row.previousElementSibling;
if (prevRow) {
  calculateRow(prevRow);
}

    row.nextElementSibling
      ?.querySelector("td:nth-child(2) input.bit")
      ?.focus();
  }
}

/* ===== T√çNH H√ÄNG ===== */
function calculateRow(row) {
  const idx = row.rowIndex - 1;

  /* --- A h√†ng hi·ªán t·∫°i --- */
  const A = [...row.querySelectorAll("td:nth-child(2) input.bit")]
    .map(i => +i.value);

  const baseMask = MASKS[idx].split("").map(Number);

  /* --- C‚ÇÅ = A‚ÇÅ XOR mask g·ªëc --- */
  const C = A.map((b, i) => b ^ baseMask[i]);
  row.querySelectorAll(".c-bit").forEach((el, i) => {
    el.value = C[i];
    el.style.color = C[i] ? "red" : "#0096c7";
  });

  /* --- MASK SAU S·ª¨A --- */
  let newMask = baseMask.slice();
  let changed = [];

  if (idx < 59) {
    const nextRow = tbody.rows[idx + 1];
    const nextInputs =
      nextRow.querySelectorAll("td:nth-child(2) input.bit");

    /* ch·ªâ s·ª≠a khi A‚ÇÇ ƒë√£ nh·∫≠p ƒë·ªß */
    if ([...nextInputs].every(i => i.value !== "")) {
      const A_next = [...nextInputs].map(i => +i.value);

      /* üîë SO S√ÅNH A‚ÇÇ V·ªöI C‚ÇÅ */
      for (let i = 0; i < 5; i++) {
        if (A_next[i] !== C[i]) {
          newMask[i] ^= 1;   // s·ª≠a mask
          changed.push(i);
        }
      }
    } else {
      row.querySelector(`#out-${idx}`).innerHTML = "";
      document.getElementById(`txt-${idx}`).value = "";
      FINAL_MASKS[idx] = null;
      highlightAMatchWithPrevC(idx);
      return;
    }
  }

  /* --- L∆ØU & HI·ªÇN TH·ªä --- */
  FINAL_MASKS[idx] = newMask.slice();

  row.querySelector(`#out-${idx}`).innerHTML =
    newMask.map((b, i) =>
      `<span class="bit-box ${changed.includes(i) ? 'changed' : ''}">${b}</span>`
    ).join("");

  document.getElementById(`txt-${idx}`).value =
    `[${newMask.join(",")}],`;

  highlightAMatchWithPrevC(idx);
  highlightAMatchWithPrevC(idx + 1);
}

/* ===== SO S√ÅNH A vs C TR∆Ø·ªöC ===== */
function highlightAMatchWithPrevC(idx) {
  if (idx <= 0 || idx >= 60) return;

  const row = tbody.rows[idx];
  const prevRow = tbody.rows[idx - 1];
  const A_inputs = row.querySelectorAll("td:nth-child(2) input.bit");
  const C_prev = [...prevRow.querySelectorAll(".c-bit")].map(i => i.value);

  A_inputs.forEach((input, i) => {
    input.classList.remove("a-match");
    if (input.value !== "" && input.value === C_prev[i]) {
      input.classList.add("a-match");
    }
  });
}

/* ===== COPY ===== */
function copyAll() {
  if (FINAL_MASKS.some(v => v === null)) {
    alert("Ch∆∞a ƒë·ªß mask h·ª£p l·ªá");
    return;
  }
  const text =
`const FINAL_MASKS = [
${FINAL_MASKS.map(m => `  [${m.join(",")}],`).join("\n")}
];`;
  navigator.clipboard.writeText(text);
  alert("ƒê√£ copy FINAL_MASKS");
}

/* ===== RESET ===== */
function resetAll() {
  document.querySelectorAll("input.bit").forEach(i => i.value = "");
  document.querySelectorAll(".c-bit").forEach(i => i.value = "");
  document.querySelectorAll("td[id^='out-']").forEach(td => td.innerHTML = "");
  document.querySelectorAll("textarea").forEach(t => t.value = "");
  FINAL_MASKS.fill(null);
}
</script>

</body>
</html>







